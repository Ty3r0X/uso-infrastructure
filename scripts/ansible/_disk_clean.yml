- name: Clean apt cache (for Debian-based systems)
  command: apt clean

- name: Perform cleanup
  file:
    path: "{{ item }}"
    state: absent
  with_items:
    - /root/anaconda-ks.cfg
    - /root/original-ks.cfg
    - /tmp
    - /usr/share/locale
    - /var/cache/apt
    - /var/lib/apt/lists
    - /var/log
    - /var/run/utmp

- name: Ensure required /var/log directories exist
  file:
    path: "{{ item.path }}"
    state: directory
    owner: "{{ item.owner | default('root') }}"
    group: "{{ item.group | default('root') }}"
    mode:  "{{ item.mode  | default('0750') }}"
  with_items:
    - "{{ req_log_dirs | default([]) }}"

- name: Remove cloud configuration files if keeping them is not required
  file:
    path: /etc/cloud
    state: absent
  when: not (keep_cloudconf | default(false))
